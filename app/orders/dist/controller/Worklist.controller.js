sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/export/library","sap/ui/export/Spreadsheet","sap/m/MessageToast","sap/m/MessageBox"],function(e,t,r,i,o,s,n,l,a){"use strict";var g=s.EdmType;return e.extend("com.orders.orders.controller.Worklist",{formatter:r,onInit:function(){var e;this._aTableSearchState=[];e=new t({worklistTableTitle:this.getResourceBundle().getText("worklistTableTitle"),shareSendEmailSubject:this.getResourceBundle().getText("shareSendEmailWorklistSubject"),shareSendEmailMessage:this.getResourceBundle().getText("shareSendEmailWorklistMessage",[location.href]),tableNoDataText:this.getResourceBundle().getText("tableNoDataText")});this.getRouter().getRoute("worklist").attachPatternMatched(this._onObjectMatched,this);this.setModel(e,"worklistView")},onUpdateFinished:function(e){var t,r=e.getSource(),i=e.getParameter("total");if(i&&r.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("worklistTableTitleCount",[i])}else{t=this.getResourceBundle().getText("worklistTableTitle")}this.getModel("worklistView").setProperty("/worklistTableTitle",t)},onPress:function(e){this._showObject(e.getSource())},onNavBack:function(){history.go(-1)},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh()}else{var t=[];var r=e.getParameter("query");if(r&&r.length>0){t=[new i("ID",o.Contains,r)]}this._applySearch(t)}},onRefresh:function(){var e=this.byId("table");e.getBinding("items").refresh()},_showObject:function(e){this.getRouter().navTo("object",{objectId:e.getBindingContext().getPath().substring("/CargoOrders".length)})},_applySearch:function(e){var t=this.byId("table"),r=this.getModel("worklistView");t.getBinding("items").filter(e,"Application");if(e.length!==0){r.setProperty("/tableNoDataText",this.getResourceBundle().getText("worklistNoDataWithSearchText"))}},createPress:function(e){this.getRouter().navTo("DetailCreate",{},true)},onDelete:function(){var e=this.byId("table").getSelectedItem();if(e){var t=e.getBindingContext().getObject().order_id;a.confirm(this.getView().getModel("i18n").getResourceBundle().getText("deleteItemOrder")+": "+t+"?",{onClose:function(r){if(r==="OK"){e.getBindingContext().delete("$auto").then(function(){l.show(this.getView().getModel("i18n").getResourceBundle().getText("Order")+" "+t+" "+this.getView().getModel("i18n").getResourceBundle().getText("deleteSuccess"))}.bind(this),function(e){l.show(this.getView().getModel("i18n").getResourceBundle().getText("deleteError")+": ",e)})}}.bind(this)})}else{l.show(this.getView().getModel("i18n").getResourceBundle().getText("selectRow"))}},onExport:function(){var e,t,r,i,o;var s=this.getView().getModel("i18n").getResourceBundle().getText("reportExport")+".xlsx";if(!this._oTable){this._oTable=this.byId("table")}o=this._oTable;t=o.getBinding("items");e=this.createColumnConfig();r={workbook:{columns:e,hierarchyLevel:"Level"},dataSource:t,fileName:s,worker:false};i=new n(r);i.build().finally(function(){i.destroy()})},createColumnConfig:function(){var e=[];e.push({label:"Status",property:"status_order ",type:g.String});e.push({label:"Order",type:g.Number,property:"order_id",scale:0});e.push({label:"Cargo date",property:"cargo_date",type:g.String});e.push({label:"City",property:"city_route_code",type:g.String});e.push({label:"Department",property:"department_route_code",type:g.String});e.push({label:"Vehicle plate",property:"vehicle_plate",type:g.String});e.push({label:"Trailer",property:"trailer",type:g.String});e.push({label:"Capacity",property:"capacity",type:g.String});e.push({label:"ID card",property:"id_card",type:g.String});e.push({label:"Driver name",property:"driver_name",type:g.String});e.push({label:"Driver last name",property:"driver_last_name",type:g.String});e.push({label:"Driving license",property:"driving_license",type:g.String});e.push({label:"Cell phone number",property:"cell_phone_number",type:g.String});return e}})});